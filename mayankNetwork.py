import numpy as np
from scipy import misc
from keras.models import Sequential
from keras.layers.core import Dense, Dropout, Activation, Flatten
from keras.layers.convolutional import Convolution2D, MaxPooling2D
from keras.preprocessing.image import ImageDataGenerator
from keras.optimizers import SGD
from keras.utils import np_utils
from keras.regularizers import l2, activity_l2

image_path = './Images/'
image_names = ['t1.bmp','t2.bmp','t3.bmp','t4.bmp','t5.bmp','t6.bmp','t7.bmp','100.bmp','101.bmp','102.bmp','103.bmp','104.bmp','105.bmp','106.bmp','107.bmp','108.bmp','109.bmp','10.bmp','110.bmp','111.bmp','112.bmp','113.bmp','114.bmp','115.bmp','116.bmp','117.bmp','118.bmp','119.bmp','11.bmp','120.bmp','121.bmp','122.bmp','123.bmp','124.bmp','125.bmp','126.bmp','127.bmp','128.bmp','129.bmp','12.bmp','130.bmp','131.bmp','132.bmp','133.bmp','134.bmp','135.bmp','136.bmp','137.bmp','138.bmp','139.bmp','13.bmp','140.bmp','141.bmp','142.bmp','143.bmp','144.bmp','145.bmp','146.bmp','147.bmp','148.bmp','149.bmp','14.bmp','150.bmp','151.bmp','152.bmp','153.bmp','154.bmp','155.bmp','156.bmp','157.bmp','158.bmp','159.bmp','15.bmp','160.bmp','161.bmp','162.bmp','163.bmp','164.bmp','165.bmp','166.bmp','167.bmp','168.bmp','169.bmp','16.bmp','170.bmp','171.bmp','172.bmp','173.bmp','174.bmp','175.bmp','176.bmp','177.bmp','178.bmp','179.bmp','17.bmp','180.bmp','181.bmp','182.bmp','183.bmp','184.bmp','185.bmp','186.bmp','187.bmp','188.bmp','189.bmp','18.bmp','190.bmp','191.bmp','192.bmp','193.bmp','194.bmp','195.bmp','196.bmp','197.bmp','198.bmp','199.bmp','19.bmp','200.bmp','201.bmp','202.bmp','203.bmp','204.bmp','205.bmp','206.bmp','207.bmp','208.bmp','209.bmp','20.bmp','210.bmp','211.bmp','212.bmp','213.bmp','214.bmp','215.bmp','216.bmp','217.bmp','218.bmp','219.bmp','21.bmp','220.bmp','221.bmp','222.bmp','223.bmp','224.bmp','225.bmp','226.bmp','227.bmp','228.bmp','229.bmp','22.bmp','230.bmp','231.bmp','232.bmp','233.bmp','234.bmp','235.bmp','236.bmp','237.bmp','238.bmp','239.bmp','23.bmp','240.bmp','241.bmp','242.bmp','243.bmp','244.bmp','245.bmp','246.bmp','247.bmp','248.bmp','249.bmp','24.bmp','250.bmp','251.bmp','252.bmp','253.bmp','254.bmp','255.bmp','256.bmp','257.bmp','258.bmp','259.bmp','25.bmp','260.bmp','261.bmp','262.bmp','263.bmp','264.bmp','265.bmp','266.bmp','267.bmp','268.bmp','269.bmp','26.bmp','270.bmp','271.bmp','272.bmp','273.bmp','274.bmp','275.bmp','276.bmp','277.bmp','278.bmp','279.bmp','27.bmp','280.bmp','281.bmp','282.bmp','283.bmp','284.bmp','285.bmp','286.bmp','287.bmp','288.bmp','289.bmp','28.bmp','290.bmp','291.bmp','292.bmp','293.bmp','294.bmp','295.bmp','296.bmp','297.bmp','298.bmp','299.bmp','29.bmp','300.bmp','301.bmp','302.bmp','303.bmp','304.bmp','305.bmp','306.bmp','307.bmp','308.bmp','309.bmp','30.bmp','310.bmp','311.bmp','312.bmp','313.bmp','314.bmp','315.bmp','316.bmp','317.bmp','318.bmp','319.bmp','31.bmp','320.bmp','321.bmp','322.bmp','323.bmp','324.bmp','325.bmp','326.bmp','327.bmp','328.bmp','329.bmp','32.bmp','330.bmp','331.bmp','332.bmp','333.bmp','334.bmp','335.bmp','336.bmp','337.bmp','338.bmp','339.bmp','33.bmp','340.bmp','341.bmp','342.bmp','343.bmp','344.bmp','345.bmp','346.bmp','347.bmp','348.bmp','349.bmp','34.bmp','350.bmp','351.bmp','352.bmp','353.bmp','354.bmp','355.bmp','356.bmp','357.bmp','358.bmp','359.bmp','35.bmp','360.bmp','361.bmp','362.bmp','363.bmp','364.bmp','365.bmp','366.bmp','367.bmp','368.bmp','369.bmp','36.bmp','370.bmp','371.bmp','372.bmp','373.bmp','374.bmp','375.bmp','376.bmp','377.bmp','378.bmp','379.bmp','37.bmp','380.bmp','381.bmp','382.bmp','383.bmp','384.bmp','385.bmp','386.bmp','387.bmp','388.bmp','389.bmp','38.bmp','390.bmp','391.bmp','392.bmp','393.bmp','394.bmp','395.bmp','396.bmp','397.bmp','398.bmp','399.bmp','39.bmp','3.bmp','400.bmp','401.bmp','402.bmp','403.bmp','404.bmp','405.bmp','406.bmp','407.bmp','408.bmp','409.bmp','40.bmp','410.bmp','411.bmp','412.bmp','413.bmp','414.bmp','415.bmp','416.bmp','417.bmp','418.bmp','419.bmp','41.bmp','420.bmp','421.bmp','422.bmp','423.bmp','424.bmp','425.bmp','426.bmp','427.bmp','428.bmp','429.bmp','42.bmp','430.bmp','431.bmp','432.bmp','433.bmp','434.bmp','435.bmp','436.bmp','437.bmp','438.bmp','439.bmp','43.bmp','440.bmp','441.bmp','442.bmp','443.bmp','444.bmp','445.bmp','446.bmp','447.bmp','448.bmp','449.bmp','44.bmp','450.bmp','451.bmp','452.bmp','453.bmp','454.bmp','455.bmp','456.bmp','457.bmp','458.bmp','459.bmp','45.bmp','460.bmp','461.bmp','462.bmp','463.bmp','464.bmp','465.bmp','466.bmp','467.bmp','468.bmp','469.bmp','46.bmp','470.bmp','471.bmp','472.bmp','473.bmp','474.bmp','475.bmp','476.bmp','477.bmp','478.bmp','479.bmp','47.bmp','480.bmp','481.bmp','482.bmp','483.bmp','484.bmp','485.bmp','486.bmp','487.bmp','488.bmp','489.bmp','48.bmp','490.bmp','491.bmp','492.bmp','493.bmp','494.bmp','495.bmp','496.bmp','497.bmp','498.bmp','499.bmp','49.bmp','4.bmp','500.bmp','501.bmp','502.bmp','503.bmp','504.bmp','505.bmp','506.bmp','507.bmp','508.bmp','509.bmp','50.bmp','510.bmp','511.bmp','512.bmp','513.bmp','514.bmp','515.bmp','516.bmp','517.bmp','518.bmp','519.bmp','51.bmp','520.bmp','521.bmp','522.bmp','523.bmp','524.bmp','525.bmp','526.bmp','527.bmp','528.bmp','529.bmp','52.bmp','530.bmp','531.bmp','532.bmp','53.bmp','54.bmp','55.bmp','56.bmp','57.bmp','58.bmp','59.bmp','5.bmp','60.bmp','61.bmp','62.bmp','63.bmp','64.bmp','65.bmp','66.bmp','67.bmp','68.bmp','69.bmp','6.bmp','70.bmp','71.bmp','72.bmp','73.bmp','74.bmp','75.bmp','76.bmp','77.bmp','78.bmp','79.bmp','7.bmp','80.bmp','81.bmp','82.bmp','83.bmp','84.bmp','85.bmp','86.bmp','87.bmp','88.bmp','89.bmp','8.bmp','90.bmp','91.bmp','92.bmp','93.bmp','94.bmp','95.bmp','96.bmp','97.bmp','98.bmp','99.bmp','9.bmp','533.JPG','534.JPG','535.JPG','536.JPG','537.JPG','538.JPG','539.JPG','540.JPG','541.JPG','542.JPG','543.JPG','544.JPG','545.JPG','546.JPG','547.JPG','548.JPG','549.JPG','550.JPG','551.JPG','552.JPG','553.JPG','554.JPG','555.JPG','556.JPG','557.JPG','558.JPG','559.JPG','560.JPG','561.JPG','562.JPG','563.JPG','564.JPG','565.JPG','566.JPG','567.JPG','568.JPG','569.JPG','570.JPG','571.JPG','572.JPG','573.JPG','574.JPG','575.JPG','576.JPG','577.JPG','578.JPG','579.JPG','580.JPG','581.JPG','582.JPG','583.JPG','584.JPG','585.JPG','586.JPG','587.JPG','588.JPG','589.JPG','590.JPG','591.JPG','592.JPG','593.JPG','594.JPG','595.JPG','596.JPG','597.JPG','598.JPG','599.JPG','600.JPG','601.JPG','602.JPG','603.JPG','604.JPG','605.JPG','606.JPG','607.JPG','608.JPG','609.JPG','610.JPG','611.JPG','612.JPG','613.JPG','614.JPG','615.JPG','616.JPG','617.JPG','618.JPG','619.JPG','620.JPG','621.JPG','622.JPG','623.JPG','624.JPG','625.JPG','626.JPG','627.JPG','628.JPG','629.JPG','630.JPG','631.JPG','632.JPG','633.JPG','634.JPG','635.JPG','636.JPG','637.JPG','638.JPG','639.JPG','640.JPG','641.JPG','642.JPG','643.JPG','644.JPG','645.JPG','646.JPG','647.JPG','648.JPG','649.JPG','650.JPG','651.JPG','652.JPG','653.JPG','654.JPG','655.JPG','656.JPG','657.JPG','658.JPG','659.JPG','660.JPG','661.JPG','662.JPG','663.JPG','664.JPG','665.JPG','666.JPG','667.JPG','668.JPG','669.JPG','670.JPG','671.JPG','672.JPG','673.JPG','674.JPG','675.JPG','676.JPG','677.JPG','678.JPG','679.JPG','680.JPG','681.JPG','682.JPG','683.JPG','684.JPG','685.JPG','686.JPG','687.JPG','688.JPG','689.JPG','690.JPG','691.JPG','692.JPG','693.JPG','694.JPG','695.JPG','696.JPG','697.JPG','698.JPG','699.JPG','700.JPG','701.JPG','702.JPG','703.JPG','704.JPG','705.JPG','706.JPG','707.JPG','708.JPG','709.JPG','710.JPG','711.JPG','712.JPG','713.JPG','714.JPG','715.JPG','716.JPG','717.JPG','718.JPG','719.JPG','720.JPG','721.JPG','722.JPG','723.JPG','724.JPG','725.JPG','726.JPG','727.JPG','728.JPG','729.JPG','730.JPG','731.JPG','732.JPG','733.JPG','734.JPG','735.JPG','736.JPG','737.JPG','738.JPG','739.JPG','740.JPG','741.JPG','742.JPG','743.JPG','744.JPG','745.JPG','746.JPG','747.JPG','748.JPG','749.JPG','750.JPG','751.JPG','752.JPG','753.JPG','754.JPG','755.JPG','756.JPG','757.JPG','758.JPG','759.JPG','760.JPG','761.JPG','762.JPG','763.JPG','764.JPG','765.JPG','766.JPG','767.JPG','768.JPG','769.JPG','770.JPG','771.JPG','772.JPG','773.JPG','774.JPG','775.JPG','776.JPG','777.JPG','778.JPG','779.JPG','780.JPG','781.JPG','782.JPG','783.JPG','784.JPG','785.JPG','786.JPG','787.JPG','788.JPG','789.JPG','790.JPG','791.JPG','792.JPG','793.JPG','794.JPG','795.JPG','796.JPG','797.JPG','798.JPG','799.JPG','800.JPG','801.JPG','802.JPG','803.JPG','804.JPG','805.JPG','806.JPG','807.JPG','808.JPG','809.JPG','810.JPG','811.JPG','812.JPG','813.JPG','814.JPG','815.JPG','816.JPG','817.JPG','818.JPG','819.JPG','820.JPG','821.JPG','822.JPG','823.JPG','824.JPG','825.JPG','826.JPG','827.JPG','828.JPG','829.JPG','830.JPG','831.JPG','832.JPG','833.JPG','834.JPG','835.JPG','836.JPG','837.JPG','838.JPG','839.JPG','840.JPG','841.JPG','842.JPG','843.JPG','844.JPG','845.JPG','846.JPG','847.JPG','848.JPG','849.JPG','850.JPG','851.JPG','852.JPG','853.JPG','854.JPG','855.JPG','856.JPG','857.JPG','858.JPG','859.JPG','860.JPG','861.JPG','862.JPG','863.JPG','864.JPG','865.JPG','866.JPG','867.JPG','868.JPG','869.JPG','870.JPG','871.JPG','872.JPG','873.JPG','874.JPG','875.JPG','876.JPG','877.JPG','878.JPG','879.JPG','880.JPG','881.JPG','882.JPG','883.JPG','884.JPG','885.JPG','886.JPG','887.JPG','888.JPG','889.JPG','890.JPG','891.JPG','892.JPG','893.JPG','894.JPG','895.JPG','896.JPG','897.JPG','898.JPG','899.JPG','900.JPG','901.JPG','902.JPG','903.JPG','904.JPG','905.JPG','906.JPG','907.JPG','908.JPG','909.JPG','910.JPG','911.JPG','912.JPG','913.JPG','914.JPG','915.JPG','916.JPG','917.JPG','918.JPG','919.JPG','920.JPG','921.JPG','922.JPG','923.JPG','924.JPG','925.JPG','926.JPG','927.JPG','928.JPG','929.JPG','930.JPG','931.JPG','932.JPG','933.JPG','934.JPG','935.JPG','936.JPG','937.JPG','938.JPG','939.JPG','940.JPG','941.JPG','942.JPG','943.JPG','944.JPG','945.JPG','946.JPG','947.JPG','948.JPG','949.JPG','950.JPG','951.JPG','952.JPG','953.JPG','954.JPG','955.JPG','956.JPG','957.JPG','958.JPG','959.JPG','960.JPG','961.JPG','962.JPG','963.JPG','964.JPG','965.JPG','966.JPG','967.JPG','968.JPG','969.JPG','970.JPG','971.JPG','972.JPG','973.JPG','974.JPG','975.JPG','976.JPG','977.JPG','978.JPG','979.JPG','980.JPG','981.JPG','982.JPG','983.JPG','984.JPG','985.JPG','986.JPG','987.JPG','988.JPG','989.JPG','990.JPG','991.JPG','992.JPG','993.JPG','994.JPG','995.JPG','996.JPG','997.JPG','998.JPG','999.JPG','1000.JPG','1001.JPG','1002.JPG','1003.JPG','1004.JPG','1005.JPG','1006.JPG','1007.JPG','1008.JPG','1009.JPG','1010.JPG','1011.JPG','1012.JPG','1013.JPG','1014.JPG','1015.JPG','1016.JPG','1017.JPG','1018.JPG','1019.JPG','1020.JPG','1021.JPG','1022.JPG','1023.JPG','1024.JPG','1025.JPG','1026.JPG','1027.JPG','1028.JPG','1029.JPG','1030.JPG','1031.JPG','1032.JPG','1033.JPG','1034.JPG','1035.JPG','1036.JPG','1037.JPG','1038.JPG','1039.JPG','1040.JPG','1041.JPG','1042.JPG','1043.JPG','1044.JPG','1045.JPG','1046.JPG','1047.JPG','1048.JPG','1049.JPG','1050.JPG','1051.JPG','1052.JPG','1053.JPG','1054.JPG','1055.JPG','1056.JPG','1057.JPG','1058.JPG','1059.JPG','1060.JPG','1061.JPG','1062.JPG','1063.JPG','1064.JPG','1065.JPG','1066.JPG','1067.JPG','1068.JPG','1069.JPG','1070.JPG','1071.JPG','1072.JPG','1073.JPG','1074.JPG','1075.JPG','1076.JPG','1077.JPG','1078.JPG','1079.JPG','1080.JPG','1081.JPG','1082.JPG','1083.JPG','1084.JPG','1085.JPG','1086.JPG','1087.JPG','1088.JPG','1089.JPG','1090.JPG','1091.JPG','1092.JPG','1093.JPG','1094.JPG','1095.JPG','1096.JPG','1097.JPG','1098.JPG','1099.JPG','1100.JPG','1101.JPG','1102.JPG','1103.JPG','1104.JPG','1105.JPG','1106.JPG','1107.JPG','1108.JPG','1109.JPG','1110.JPG','1111.JPG','1112.JPG','1113.JPG','1114.JPG','1115.JPG','1116.JPG','1117.JPG','1118.JPG','1119.JPG','1120.JPG','1121.JPG','1122.JPG','1123.JPG','1124.JPG','1125.JPG','1126.JPG','1127.JPG','1128.JPG','1129.JPG','1130.JPG','1131.JPG','1132.JPG','1133.JPG','1134.JPG','1135.JPG','1136.JPG','1137.JPG','1138.JPG','1139.JPG','1140.JPG','1141.JPG','1142.JPG','1143.JPG','1144.JPG','1145.JPG','1146.JPG','1147.JPG','1148.JPG','1149.JPG','1150.JPG','1151.JPG','1152.JPG','1153.JPG','1154.JPG','1155.JPG','1156.JPG','1157.JPG','1158.JPG','1159.JPG','1160.bmp','1161.bmp','1162.bmp','1163.bmp','1164.bmp']
image_names = [image_path + s for s in image_names]

imsize = 100
images = np.array([np.array(misc.imresize(misc.imread(image_names[i]), [imsize, imsize]).transpose(2,0,1)) for i in range(len(image_names))], dtype='float32') / 255

means = np.array([63.963,25.335,48.937,35.886,66.509,54.58,77.882,32.561,66.36,44.695,39.235,9.2291,41.331,68.922,27.958,75.352,50.638,82.911,32.137,51.842,30.319,68.217,24.871,31.294,26.098,70.433,26.531,51.317,60.947,18.785,19.75,79.367,67.298,70.995,81.905,52.843,41.427,48.814,72.883,15.895,86.609,48.529,73.026,27.006,32.309,65.943,67.163,59.842,67.587,61.929,77.402,77.458,20.582,26.406,61.149,76.924,55.592,34.211,71.323,41.971,72.457,66.394,65.796,55.779,79.438,73.088,11.977,73.639,28.513,17.519,79.417,73.834,56.399,41.347,8.2468,70.638,46.369,80.5,71.863,49.796,75.178,65.418,30.109,77.602,60.288,25.136,63.045,74.541,72.91,74.365,61.345,58.43,53.702,66.108,61.462,39.413,29.128,52.631,23.012,67,56.47,49.808,28.712,28.96,46.054,64.552,31.729,46.475,35.484,74.661,26.667,69.184,61.789,55.482,78.517,66.212,30.936,9.1391,49.5,24.515,50.994,75.482,77.96,72.591,43.669,53.841,52.291,76.385,70.542,42.686,61.713,13.114,73.111,57.191,75.179,68.147,67.989,48.803,53.021,67.282,84.16,59.257,68.311,14.638,64.053,49.476,72.708,41.1,57.667,52,43.247,45.371,81.769,81.256,64.681,53.152,30.983,68.824,59.032,3.4976,77.114,53.08,59.45,43.882,34.123,56.445,10.727,52.03,74.272,74.949,73.185,35.836,50.575,61.777,39.154,46.708,48.78,57.243,70.324,71.796,68.36,61.613,71.901,49.09,85.216,62.286,27.154,39.019,60.152,61.791,70.742,75.642,62.079,78.612,21.574,83.062,44.399,65.325,50.188,47.027,71.636,68.411,28.104,70.645,63.289,34.095,43.571,45.71,20.168,66.915,56.077,40.741,30.912,47.798,43.458,61.014,35.812,30.917,43.547,40.672,12.834,72.469,38.379,27.072,49.637,56.397,38.506,41.26,74.788,63.908,51.138,87.366,67.199,51.173,13.719,44.929,19.376,35.104,69.671,22.656,56.678,49.247,52.792,69.937,49.302,34.267,35.169,76.291,53.552,77.071,44.263,53.479,65.391,77.927,52.354,46.908,58.42,82.539,6.3934,68.789,67.724,67.189,80.591,51.093,58.39,43.864,47.379,11.76,86.602,62.318,51.552,27.962,8.933,67.687,66.862,79.802,41.339,58.917,58.652,30.538,69.283,34.255,58.655,71.029,52.031,68.099,52.682,76.276,43.202,64.552,50.668,62.924,34.38,24.971,67.382,44.562,36.521,23.165,43.883,53.866,50.135,52.922,43.329,57.377,28.344,66.578,68.032,59.628,43.187,24.03,23.213,74.206,71.506,61.317,64.618,79.114,63.761,82.111,69.703,35.038,56.614,40.727,74.018,58.376,64.448,30.151,59.006,82.775,81.84,69.756,48.547,53.833,68.149,51.665,36.896,65.922,73.279,44.446,58.64,54.405,76.846,71.257,76.097,38.123,79.703,55.462,33.14,67.596,34.098,58.305,17.957,56.434,33.011,45.862,16.904,79.768,72.093,66.921,71.898,59.665,55.995,74.166,62.251,71.564,59.481,64.17,67.401,52.686,37.915,13.006,63.335,62.615,46.416,61.948,34.497,58.762,49.88,57.381,65.199,57.333,18.938,18.478,60.211,65.838,71.056,17.006,83.177,47.244,13.126,25.331,61.538,41.1,72.039,63.196,69.387,62.465,38.191,46.859,75.577,79.08,44.447,7.6881,77.201,56.095,6.0433,75.78,65.533,72.923,55.775,69.207,76.409,57.644,7.3696,58.547,15.22,59.41,50.14,53.78,65.174,22.545,64.089,54.162,75.522,60.011,66.014,49.5,52.78,50.093,51.831,45.203,67.783,53.86,70.756,62.345,57.465,12.933,81.345,67.617,56.477,62.806,27.539,85.217,57.098,65.503,32.561,35.642,80.863,51.899,31.978,68.453,37.864,71.483,27.205,56.186,63.09,73.075,78.804,63.071,40.486,62.138,78.629,27.842,43.281,70.37,75.688,76.237,52.429,38.235,59.421,62.566,82.283,59.005,52.011,64.79,17.975,48.273,78.819,67.128,71.882,70.048,50.592,69.579,14.178,59.475,27.698,42.795,20.349,83.283,10.669,61.558,7.5,44.731,62.256,74.183,37.756,54.459,72.87,41.861,60.523,47.883,64.799,39.805,40.392,51.872,58.216,48.626,65.111,81.126,57.403,56.246,76.095,71.521,69.647,54.422,4.9378,56.427,30.146,36.153,55.259,56.107,68.602,50.122,40.871,72.314,32.103,42.412,37.049,66.617,64.82,39.8,66.096,75.329,63.075,56.356,71.769,11.726,77.903,73.624,52.71,29.503,40.397,63.148,62.53,64.118,35.552,52.552,51.901,68.056,59.99,60.75,78.53,21.236,69.48,65.429,25.906,77.288,61.093,78.808,65.07,78.679,70.206,65.263,44.413,72.851,48.699,45.418,50.259,65.89,35.273,21.801,74.339,61.167,67.978,72.105,43.119,73.486,29.583,47.325,52.738,75.182,80.362,76.118,78.104,68.421,63.581,41.681,65.551,58.395,80.936,60.016,57.011,66.696,67.524,81.47,84.814,78.136,57.855,73.069,68.809,8.2034,49.408,63.048,45.303,56.193,48.516,60.946,42.765,66.682,74.629,50.951,31.497,48.284,59.988,65.455,65.493,38.489,71.006,53.302,58.158,40.128,81.838,79.833,74.907,42.335,48.856,69.878,78.333,45.808,71.166,61.495,32.322,50.587,31.77,46.466,55.994,70.658,21.143,26.202,16.135,63.762,64.518,31.456,49.641,43.96,43.538,45.509,49.171,73.946,35.379,43.019,59.365,66.994,27.839,53.776,71.364,30.725,6.5207,15.647,71.801,12.563,54.194,16.601,77.079,19.492,63.543,19.804,19.554,23.058,52.139,60.043,15.583,55.032,9.2083,9.8276,34.944,6.2242,9.9097,3.42,68.112,38.184,14.962,8.4778,4.865,7.0785,10.442,18.596,40.075,37.339,27.853,60.098,29.476,49.127,66.79,12.556,77.828,37.254,25.238,43.703,9.7389,27.661,30.163,48.02,4.8462,77.746,5.2778,17.488,4.3439,19.174,17.023,48.205,45.569,18.006,72.444,61.933,53.831,57.926,86.347,46.413,31.833,88.341,90.245,66.537,46.424,82.613,62.109,80.699,27.964,23.538,30.737,36.963,45.524,31.5,83.48,77.487,46.875,45.335,23.647,19.644,4.3081,54.426,76.904,43.986,69.423,83.921,69.287,59.829,5.6587,72.952,69.4,69.534,76.984,64.503,79.503,81.585,57.525,25.774,60.63,83.845,44.143,64.962,87.371,65.603,76.218,75.471,48.168,72.921,74.398,65.48,77.178,82.073,76.256,85.524,83.416,80.333,87.582,73.54,12.796,82.563,84.781,83.621,91.078,78.024,81.552,80.934,92.432,88.918,49.651,77.066,82.976,90.55,83.41,41.331,36.816,74.517,71.682,60.131,79.395,66.107,77.438,79.614,68.548,24.514,61.056,69.615,9.5515,64.282,8.7225,21.495,21.193,40.708,85.977,71.492,83.363,74.688,59.936,76.804,64.61,37.023,25.472,32.456,16.027,14.305,21.77,8.2755,78.331,50.976,24.937,13.029,12.899,44.469,76.109,82.478,68.981,26.605,77.358,36.24,34.946,21.723,66.665,59.176,61.68,21.768,26.239,22.708,71.327,63.48,72.789,28.704,91.436,34.787,70.656,60.785,79.593,80.982,84.081,70.608,26.643,83.68,65.006,80.077,20.834,79.081,76.662,49.205,74.944,67.91,27.135,66.282,45.923,80.211,80.695,57.977,23.301,12.044,28.776,34.419,14.216,26.296,6.5249,37.13,37.401,87.848,72.26,61.5,65.083,43.274,83.545,83.462,29.473,27.889,72.926,50.294,52.103,28.176,62.944,72.046,75.06,61.166,45.469,43.432,56.135,57.718,51.659,73.963,70.706,22.013,78.708,67.176,58.022,70.369,63.87,13.971,73.242,77.426,61.425,70.287,38.399,75.541,67.473,77.246,78.025,70.7,73.375,69.126,75.869,74.649,81.852,75.155,10.177,47.331,49.099,57.722,58.994,38.563,50.351,59.432,60.246,73.18,71.832,70.521,76.471,79.494,49.392,67.615,61.884,60.547,53.637,62.253,34.292,70.295,74.025,77.451,24.204,25.437,74.462,75.983,42.423,58.798,62.796,54.618,77.428,32.628,64.988,49.873,44.688,4.8075,61.927,78.842,63.641,71.815,69.378,72.843,65.039,80.552,68.914,80.101,68.854,73.308,69.613,56.696,74.226,66.943,44.955,49.452,65.364,56.371,44.68,74.819,46.784,34.976,61.101,81.037,54.803,78.513,86.213,37.425,58.947,46.769,65.461,83.432,61.02,65.45,50.831,49.067,56.512,53.557,40.672,30.489,64.321,62.35,66.214,63.146,57.843,56.157,46.67,54.174,75.874,38.1,58.81,63.96,65.635,29.968,42.44,62.962,55.149,73.867,51.309,72.646,42.771,72.03,72.516,79.939,76.163,81.516,72.757,67.456,77.555,69.788,75.758,67.505,75.582,48.915,21.876,59.661,56.143,75.928,25.929,73.312,82.302,80.484,61.074,37.76,57.856,81.219,72.06,57.327,54.62,72.489,77.248,64.233,39.627,49.444,60.217,55.384,61.219,73,83.116,66.675,76.081,68.564,39.392,49.327,56.733,84.044,58.771,66,75.253,74.747,82.205,66.611,70.632,71.275,61.933,26.661,59.636,52.195,65.284,70.267,78.186,83.375,82.313,72.833,49.957,80.183,53.879,73.062,77.903,59.984,56.868,76.264,86.06,82.513,10.761,74.615,76.286,78.796,64.369,57.701,50.814,75.634,66.523,78.416,73.279,69.589,50,80.632,43.593,31.641,76.963,64.005,49.989,52.429,53.645,57.431,74.78,76.967,55.012,49.617,77.2,61.606,72.093,80.629,70.074,55.914,46.039,72.547,50.418,64.33,65.901,40.39,66.411,77.017,67.605,44.172,51.902,70.674,71.764,61.106,71.272,47.21,73.205,75.835,48.453,72.127,68.197,58.643,61.852,71.126,28.091,74.363,28.811,51.86,48.145,47.836,21.686,11.9,62.662,87.066,72.754], dtype='float32')
means = means/50 - 1

stds = np.array([18.376,13.651,18.925,18.241,19.258,19.958,19.646,19.125,20.22,19.661,19.339,11.902,21.785,21.24,15.527,16.552,19.246,15.124,18.598,21.845,16.3,19.554,16.164,19.076,21.223,20.11,18.755,21.838,20.554,15.525,15.989,17.246,20.488,20.189,16.023,20.04,19.909,18.078,20.86,15.256,13.664,21.98,17.457,20.761,22.119,19.217,21.091,21.733,18.728,18.524,17.793,17.614,20.738,15.273,21.326,18.531,22.069,19.912,18.317,18.88,17.953,21.6,19.65,23.135,15.581,19.159,13.57,18.499,17.656,16.807,15.3,16.814,21.583,20.659,10.489,21.155,21.599,17.219,18.613,20.885,18.465,18.844,16.113,16.804,21.32,17.673,20.471,19.514,19.757,19.52,22.716,20.905,19.17,24.306,18.74,21.701,16.706,20.508,16.496,18.963,22.002,22.793,17.144,16.583,20.337,21.059,18.192,19.016,20.391,18.99,16.83,19.034,19.554,23.602,18.075,21.091,20.539,10.579,20.479,17.781,20.231,19.279,18.268,21.932,21.686,21.968,21.46,20.468,20.952,19.82,21.004,17.114,18.23,19.822,19.679,21.2,19.784,19.064,21.282,20.468,16.038,22.674,19.028,13.501,18.989,20.55,17.958,18.679,22.335,19.764,19.123,23.688,16.77,16.515,17.733,18.178,17.439,17.725,20.063,6.7629,18.279,19.493,21.338,19.785,17.986,19.362,11.161,19.843,19.242,19.576,18.361,25.027,22.335,17.81,17.226,23.278,18.837,22.018,19.028,17.393,21.595,20.641,21.543,21.309,15.58,20.869,22.451,25.023,21.022,19.954,17.707,17.656,20.796,15.588,13.98,15.285,19.839,19.452,21.863,25.041,20.857,18.869,16.682,19.007,23.575,19.019,20.771,21.853,16.186,26.158,19.186,20.739,18.431,18.894,19.672,21.197,18.372,24.247,23.317,21.045,17.634,20.452,19.897,17.637,24.355,20.721,19.087,24.686,18.064,21.142,21.379,13.573,20.525,19.858,15.063,23.524,15.094,20.944,18.481,17.784,21.43,22.05,21.832,16.628,22.467,24.495,19.066,17.495,22.755,17.905,20.015,21.542,21.212,17.384,20.566,18.991,19.677,16.902,12.481,18.45,18.369,18.988,16.966,20.338,22.536,23.447,23.047,14.272,14.916,22.815,23.428,16.9,10.236,18.794,19.186,16.917,19.265,19.547,21.51,16.209,19.264,20.23,18.795,17.824,19.77,19.102,18.692,17.355,19.774,22.314,20.5,20.234,21.649,17.305,19.489,20.356,20.953,19.29,24.367,22.961,21.075,20.603,19.543,22.565,18.572,21.894,20.405,19.731,19.42,16.341,14.869,16.615,17.299,18.145,19.908,16.716,20.691,14.573,18.62,17.881,20.66,19.395,20.804,22.224,19.936,19.251,19.414,15.006,17.761,18.654,20.672,20.828,19.325,21.346,18.114,20.371,21.701,20.267,20.334,22.039,16.833,17.395,18.015,23.627,17.03,19.894,18.472,20.192,19.431,21.678,13.891,22.847,19.025,25.126,18.065,18.491,18.8,23.465,19.008,20.681,20.02,16.608,19.928,22.388,19.188,21.011,20.62,20.001,22.586,13.584,20.794,19.065,17.31,21.694,18.211,17.474,22.445,19.017,21.784,21.497,15.193,15.408,20.539,19.957,19.084,17.446,16,20.43,15.601,17.99,19.662,15.606,20.018,19.482,18.954,17.274,20.469,24.086,19.746,17.907,17.774,11.027,15.275,22.824,10.753,21.134,22.567,20.778,22.929,19.661,16.745,22.672,12.298,21.845,12.128,20.083,20.514,23.623,17.948,17.778,21.936,19.903,18.98,19.678,20.849,20.094,20.584,20.32,20.652,20.089,17.569,22.212,18.7,21.812,20.389,17.185,19.044,19.458,21.468,19.867,16.76,14.749,21.801,21.505,17.156,19.914,17.17,19.472,18.272,18.06,20.932,18.248,15.787,18.556,18.542,20.58,15.742,24.223,20.147,22.149,17.627,17.886,18.79,18.298,16.881,17.159,20.973,17.912,20.641,19.163,17.617,21.534,19.706,19.16,14.718,23.667,14.561,18.59,21.103,19.411,24.897,18.345,15.845,23.486,16.536,19.233,15.279,15.882,11.605,18.788,11.411,26.216,21.487,18.481,16.744,22.021,21.147,18.153,23.476,21.072,20.762,17.2,19.833,21.393,20.947,20.567,23.67,17.18,20.077,25.465,19.173,19.893,19.589,20.367,9.3539,18.653,19.493,18.484,20.254,20.029,18.524,22.068,22.058,18.495,18.486,19.044,20.298,19.688,22.21,18.769,17.82,18.224,26.327,19.334,18.998,12.858,19.302,20.402,22.794,15.698,20.154,20.495,21.073,20.476,27.102,24.739,25.076,19.498,21.438,22.298,16.893,16.523,21.128,17.998,16.61,17.993,19.191,17.181,20.181,17.521,20.614,21.168,18.14,20.222,21.491,20.438,22.02,18.344,19.721,16.12,18.401,19.09,15.639,18.44,19.77,20.469,18.783,19.475,20.422,18.061,17.244,17.781,17.801,18.772,20.942,16.93,22.902,21.046,15.547,21.317,19.379,17.584,20.519,17.024,14.257,17.208,21.409,21.549,18.727,11.197,19.873,19.93,24.591,21.385,21.258,19.427,20.803,19.968,18.161,20.045,18.473,23.849,22.297,21.554,21.279,21.086,19.5,22.797,20.593,21.337,14.816,15.138,18.867,21.557,24.757,20.152,17.381,21.437,21.041,25.346,21.467,25.392,16.059,18.646,21.813,19.748,15.638,17.075,15.798,20.494,20.007,17.26,20.71,22.115,21.092,19.545,20.935,19.14,23.851,28.593,19.378,23.351,16.377,21.712,18.563,19.922,11.887,14.843,19.965,16.105,19.486,14.964,17.872,15.523,21.318,21.123,20.097,21.054,21.856,23.503,13.517,21.219,12.986,12.426,18.282,13.596,12.288,6.7558,19.366,22.566,14.557,11.511,10.03,11.175,18.163,16.216,19.922,18.568,15.939,18.784,18.198,25.588,20.961,12.413,16.089,16.063,18,20.98,13.477,17.313,19.955,24.404,8.9575,17.981,7.637,20.308,13.053,18.567,16.28,24.394,21.537,15.623,18.958,21.328,20.81,23.147,15.41,22.336,19.713,13.875,13.323,20.099,21.872,15.567,21.81,19.188,16.495,15.811,20.752,16.994,21.311,17.954,15.66,18.648,23.349,21.302,18.104,17.485,8.2635,24.535,19.41,24.718,21.152,15.057,20.319,23.341,10.85,18.529,19.198,20.283,19.046,19.11,17.661,17.142,23.357,21.113,24.76,16.362,23.84,20.543,13.349,21.466,18.94,17.602,21.24,19.425,18.935,21.131,17.433,16.471,18.616,16.83,15.307,15.357,13.108,19.614,13.716,17.04,14.877,14.395,12.299,18.782,16.572,17.935,12.038,11.58,20.833,16.584,16.493,12.357,18.443,23.146,23.659,18.467,20.71,21.594,19.325,20.634,21.337,16.41,20.062,18.772,24.174,19.051,15.418,22.95,14.21,21.898,19.036,21.057,14.689,22.406,17.76,17.601,20.357,16.866,19.946,19.854,21.028,24.131,18.124,19.103,16.179,10.981,18.335,19.707,18.151,12.636,13.701,20.639,20.101,16.865,21.411,20.268,17.239,22.156,16.748,16.265,20.684,21.899,19.332,18.202,20.77,23.666,21.506,23.52,17.777,25.571,11.813,19.406,19.962,22.151,17.155,16.473,15.998,21.149,18.339,15.793,21.432,16.371,17.835,19.481,20.321,23.224,19.146,20.638,19.767,19.959,24.556,18.796,17.05,21.121,18.549,14.145,17.978,19.545,13.98,17.928,10.623,19.206,24.023,14.675,22.544,20.013,20.273,20.942,15.756,15.743,20.275,18.22,19.172,22.014,26.014,17.4,19.735,18.551,18.006,20.119,19.626,22.165,19.826,21.228,23.031,19.925,17.958,15.334,16.203,19.399,20.78,18.813,19.885,14.212,18.324,16.271,19.962,18.188,22.353,19.964,19.865,18.214,19,20.111,18.842,21.348,17.319,19.585,16.708,20.117,11.655,20.785,20.558,20.333,22.467,20.58,22.13,18.637,24.706,16.913,20.68,19.645,16.972,16.482,20.631,20.508,20.992,21.513,20.6,23.825,22.687,18.964,18.053,19.026,18.516,16.502,18.279,17.079,19.09,23.176,20.066,21.738,16.643,19.754,21.074,19.816,18.494,10.612,20.299,18.895,19.264,19.317,21.417,20.169,22.496,17.755,19.935,16.888,20.152,18.8,21.816,23.249,18.991,19.816,22.562,24.289,20.353,20.222,21.119,20.197,23.604,18.446,17.9,18.387,22.699,19.333,16.038,18.594,21.235,20.182,20.443,15.117,20.649,20.464,23.841,21.746,20.474,19.628,24.804,21.127,20.016,21.288,21.218,23.777,23.31,27.07,20.102,18.746,23.7,22.845,25.613,20.854,21.748,18.076,21.508,24.159,21.278,18.612,23.781,19.036,23.101,19.098,20.306,17.729,18.226,16.615,20.505,19.16,16.165,19.875,19.075,19.658,17.493,20.114,16.317,23.789,22.004,17.912,18.282,17.358,16.789,17.523,22.049,18.928,20.818,15.313,18.659,20.408,20.492,21.424,18.149,20.143,21.86,22.819,19.976,20.154,18.022,22.767,17.236,20.579,18.699,20.268,17.841,21.392,19.627,15.757,20.228,20.893,21.805,17.781,16.893,19.839,19.914,22.145,19.766,17.65,22.258,20.664,19.119,19.217,17.278,15.452,15.795,18.191,20.607,15.568,18.893,18.506,18.899,20.376,24.663,18.74,13.935,16.543,12.675,19.528,19.14,18.158,23.787,21.391,21.807,21.338,19.073,16.213,18.133,20.399,21.172,16.989,24.778,17.382,18.465,19.993,21.452,22.551,22.861,21.59,18.653,17.608,23.949,22.789,17.481,20.118,18.048,15.798,19.641,23.374,25.79,21.096,20.852,19.908,20.986,18.421,19.552,18.348,20.514,20.434,19.798,18.597,17.853,20.487,17.823,19.626,19.151,16.414,19.226,18.636,22.038,21.477,19.409,17.648,18.433,20.648,19.122,21.399,20.913,24.361,15.115,12.983,20.502,14.629,19.194], dtype='float32')
std_w = 1/(stds/25)

print 'LIVE images read: '
print images.shape
print means
print std_w

model = Sequential()

filters_1 = 6
filters_2 = 16
filters_3 = 120
filters_dense = 84
pool_stride = 2
conv_stride = 5

model.add(Convolution2D(filters_1, conv_stride, conv_stride, border_mode='same', input_shape=(3, imsize, imsize)))
model.add(Activation('relu'))
model.add(MaxPooling2D((pool_stride,pool_stride)))
model.add(Convolution2D(filters_2, conv_stride, conv_stride, border_mode='same' ))
model.add(Activation('relu'))
model.add(MaxPooling2D((pool_stride,pool_stride)))
model.add(Convolution2D(filters_3, conv_stride, conv_stride))
model.add(Activation('relu'))

model.add(Flatten())
model.add(Dense(filters_dense))                           
model.add(Activation('relu'))

model.add(Dense(1, W_regularizer=l2(0.01)))
model.add(Activation('linear') )

model.compile(loss='mean_squared_error', optimizer='rmsprop')
print 'model compiled'

datagen = ImageDataGenerator(
  featurewise_center=False,  # set input mean to 0 over the dataset
  samplewise_center=False,  # set each sample mean to 0
  featurewise_std_normalization=False,  # divide inputs by std of the dataset
  samplewise_std_normalization=False,  # divide each input by its std
  zca_whitening=False,  # apply ZCA whitening
  rotation_range=0,  # randomly rotate images in the range (degrees, 0 to 180)
  width_shift_range=0.1,  # randomly shift images horizontally (fraction of total width)
  height_shift_range=0.1,  # randomly shift images vertically (fraction of total height)
  horizontal_flip=True,  # randomly flip images
  vertical_flip=False # randomly flip images
) 
datagen.fit(images)

nb_epoch = 20
batch_size = 100
#mode.fit_generator(datagen.flow(images, means, batch_size=batch_size), samples_per_epoch=images.shape[0],
model.fit(images, means, 
          batch_size=batch_size,
          nb_epoch=nb_epoch,
          shuffle=True,
          verbose=1,
          validation_split=0.2)
          #sample_weight=std_w)
print 'model fit'

predictions = model.predict(images)
print 'model predictions: '
print (predictions + 1) * 50

print 'real answers: '
print (means + 1) * 50
